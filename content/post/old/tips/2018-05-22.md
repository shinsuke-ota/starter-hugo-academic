+++
math = false
highlight = true
tags = []
title = "TRootEmbeddedCanvasにAdoptCanvasする時の注意"

# Optional featured image (relative to `static/img/` folder).
[header]
image = ""
caption = ""
draft = true

+++

検証済みバージョン：ROOT5.36.34

TRootEmbeddedCanvasは、自前のGUIを作成するときのキャンバスを準備してくれるが、
自作のキャンナスクラスを作成して埋め込むこともできる。それがTRootEmmbeddedCanvas::AdoptCanvasメソッド。

```c++:
fRootEmbeddedCanvas1322 = new TRootEmbeddedCanvas(0,this,800,800);
fRootEmbeddedCanvas1322->SetName("fRootEmbeddedCanvas1322");
Int_t wfRootEmbeddedCanvas1322 = fRootEmbeddedCanvas1322->GetCanvasWindowId();
fCanvas = new art::TArtCanvas("canvas",800,800,wfRootEmbeddedCanvas1322);
fRootEmbeddedCanvas1322->GetCanvas()->Close();
fRootEmbeddedCanvas1322->AdoptCanvas(fCanvas);
```

TRootEmbeddedCanvas で作られる TCanvas が AdoptCanvas した時に誰にも使われなくなってしまい、
TGMainFrame をCleanupしても残ったままになってしまい、TGMainFrameのCloseWindow後に

artemis [2] Error in <RootX11ErrorHandler>: BadDrawable (invalid Pixmap or Window parameter) (XID: 44040451, XREQ: 62)
Error in <RootX11ErrorHandler>: BadWindow (invalid Window parameter) (XID: 44040451, XREQ: 2)

のようなエラーを吐くことになる。

そのため GetCanvas()->Close() をAdoptCanvasする前に呼んで消去しておく必要がある。


